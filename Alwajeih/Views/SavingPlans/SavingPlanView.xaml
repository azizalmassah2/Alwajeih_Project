<UserControl
  x:Class="Alwajeih.Views.SavingPlans.SavingPlanView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  FlowDirection="RightToLeft"
  FontFamily="{StaticResource Tajawal}"
  FontSize="14"
  xmlns:vm="clr-namespace:Alwajeih.ViewModels.SavingPlans"
  xmlns:converters="clr-namespace:Alwajeih.Utilities.Converters"
>
  <UserControl.DataContext>
    <vm:SavingPlanViewModel />
  </UserControl.DataContext>
  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/Resources/Styles/ScrollBarStyles.xaml" />
        <ResourceDictionary Source="/Resources/Styles/Colors.xaml" />
        <ResourceDictionary Source="/Resources/Styles/Buttons.xaml" />
        <ResourceDictionary Source="/Resources/Styles/DataGrids.xaml" />
        <ResourceDictionary Source="/Resources/Styles/MainStyles.xaml" />
      </ResourceDictionary.MergedDictionaries>
      
      <!-- Converters -->
      <converters:CollectionFrequencyToTextConverter x:Key="FrequencyTextConverter" />
      <converters:CollectionFrequencyToColorConverter x:Key="FrequencyColorConverter" />
    </ResourceDictionary>
  </UserControl.Resources>
  <Grid Background="#F8FAFC">
    <ScrollViewer VerticalScrollBarVisibility="Auto" Style="{StaticResource ModernScrollViewer}">
      <StackPanel Margin="20,20">
        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
        <StackPanel Margin="0,0,0,20">
          <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
            <TextBlock Text="ðŸ“ˆ" FontSize="24" Margin="0,0,10,0" VerticalAlignment="Center" />
            <TextBlock
              Text="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù‡Ù…"
              FontSize="22"
              FontWeight="Bold"
              Foreground="#1E293B"
              VerticalAlignment="Center"
            />
          </StackPanel>
          <TextBlock
            Text="Ø¥Ø¶Ø§ÙØ© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø£Ø³Ù‡Ù… Ø§Ù„Ø§Ø¯Ø®Ø§Ø±"
            FontSize="13"
            Foreground="#64748B"
            Margin="34,0,0,0"
          />
        </StackPanel>
        <Grid Margin="0">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="150" />
            <ColumnDefinition Width="350" />
          </Grid.ColumnDefinitions>
          <!-- Ø§Ù„Ø­ØµØµ Ø§Ù„Ù†Ø´Ø·Ø© -->
          <Border
            Grid.Column="0"
            Background="White"
            CornerRadius="12"
            Padding="20"
            Margin="0,0,15,0"
          >
            <Border.Effect>
              <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="0" Opacity="0.08" />
            </Border.Effect>
            <StackPanel>
              <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
              <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                <TextBlock Text="ðŸŸ¢" FontSize="18" Margin="0,0,8,0" VerticalAlignment="Center" />
                <TextBlock
                  Text="Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ù†Ø´Ø·Ø©"
                  FontSize="16"
                  FontWeight="SemiBold"
                  Foreground="#1E293B"
                  VerticalAlignment="Center"
                />
              </StackPanel>
              
              <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
              <Border Background="White" 
                      BorderBrush="#CBD5E1" 
                      BorderThickness="1" 
                      CornerRadius="8" 
                      Padding="10,6"
                      Margin="0,0,0,15">
                <Grid>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                  </Grid.ColumnDefinitions>
                  <TextBlock Text="ðŸ”" 
                             Grid.Column="0" 
                             FontSize="14" 
                             Margin="0,0,8,0" 
                             VerticalAlignment="Center" 
                             Foreground="#64748B" />
                  <TextBox Grid.Column="1"
                           Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                           BorderThickness="0"
                           Background="Transparent"
                           VerticalAlignment="Center"
                           FontSize="13">
                    <TextBox.Style>
                      <Style TargetType="TextBox">
                        <Setter Property="Foreground" Value="#1E293B" />
                        <Style.Triggers>
                          <Trigger Property="Text" Value="">
                            <Setter Property="Background">
                              <Setter.Value>
                                <VisualBrush Stretch="None" AlignmentX="Left">
                                  <VisualBrush.Visual>
                                    <TextBlock Text="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø¶Ùˆ..." 
                                               Foreground="#94A3B8" 
                                               FontSize="13" />
                                  </VisualBrush.Visual>
                                </VisualBrush>
                              </Setter.Value>
                            </Setter>
                          </Trigger>
                        </Style.Triggers>
                      </Style>
                    </TextBox.Style>
                  </TextBox>
                </Grid>
              </Border>
              
              <!-- DataGrid Ù…Ø¹ Border -->
              <Border
                CornerRadius="8"
                BorderBrush="#E2E8F0"
                BorderThickness="1"
                Background="White"
                Margin="0,12,0,0"
              >
                <DataGrid
                  ItemsSource="{Binding ActivePlans}"
                  SelectedItem="{Binding SelectedPlan}"
                  Height="550"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  Style="{StaticResource ModernDataGrid}"
                  LoadingRow="DataGrid_LoadingRow"
                >
                <DataGrid.Columns>
                  <DataGridTemplateColumn Header="#" Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Header}" 
                                   HorizontalAlignment="Center" 
                                   FontWeight="SemiBold"/>
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>
                  <DataGridTextColumn Header="Ø§Ù„Ø¹Ø¶Ùˆ" Binding="{Binding MemberName}" Width="2*" />
                  <DataGridTemplateColumn Header="Ù†ÙˆØ¹ Ø§Ù„ØªØ­ØµÙŠÙ„" Width="1*">
                    <DataGridTemplateColumn.CellTemplate>
                      <DataTemplate>
                        <Border Background="{Binding CollectionFrequency, Converter={StaticResource FrequencyColorConverter}}"
                                CornerRadius="4"
                                Padding="8,4"
                                HorizontalAlignment="Center">
                          <TextBlock Text="{Binding CollectionFrequency, Converter={StaticResource FrequencyTextConverter}}"
                                     FontWeight="Medium"
                                     FontSize="12"
                                     Foreground="White"
                                     HorizontalAlignment="Center"/>
                        </Border>
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>
                  <DataGridTextColumn
                    Header="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙŠÙˆÙ…ÙŠ"
                    Binding="{Binding DailyAmount, StringFormat=N2}"
                    Width="1.2*"
                  />
                  <DataGridTextColumn
                    Header="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"
                    Binding="{Binding TotalAmount, StringFormat=N2}"
                    Width="1.2*"
                  />
                  <DataGridTextColumn
                    Header="Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©"
                    Binding="{Binding StartDate, StringFormat=yyyy-MM-dd}"
                    Width="*"
                  />
                  <DataGridTextColumn
                    Header="Ø§Ù„Ù†Ù‡Ø§ÙŠØ©"
                    Binding="{Binding EndDate, StringFormat=yyyy-MM-dd}"
                    Width="*"
                  />
                  <!-- ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥ØªÙ…Ø§Ù… Ù…Ø¤Ù‚ØªØ§Ù‹ -->
                  <!--
                  <DataGridTemplateColumn Header="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡" Width="Auto" MinWidth="100">
                    <DataGridTemplateColumn.CellTemplate>
                      <DataTemplate>
                        <Button
                          Content="ðŸŽ‰ Ø¥ØªÙ…Ø§Ù…"
                          Command="{Binding DataContext.CompletePlanCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                          Style="{StaticResource SuccessButton}"
                          Height="35"
                          FontSize="12"
                        />
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>
                  -->
                </DataGrid.Columns>
              </DataGrid>
              </Border>
            </StackPanel>
          </Border>
          <!-- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù‡Ù… -->
          <Border Grid.Column="1" Background="White" CornerRadius="16" Padding="24">
            <Border.Effect>
              <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="0" Opacity="0.08" />
            </Border.Effect>
            <StackPanel>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <TextBlock Text="âœï¸" FontSize="22" Margin="0,0,10,0" VerticalAlignment="Center" />
                <TextBlock
                  Text="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù‡Ù…"
                  FontSize="18"
                  FontWeight="SemiBold"
                  Foreground="#1E293B"
                  VerticalAlignment="Center"
                />
              </StackPanel>
              
              <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ -->
              <Border
                Background="{StaticResource Card2Color}"
                CornerRadius="10"
                Padding="15"
                Margin="0,0,0,20"
              >
                <StackPanel>
                  <TextBlock Text="Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ù…Ø­Ø¯Ø¯" Style="{StaticResource FieldLabel}" Margin="0,0,0,5" />
                  <TextBlock 
                    Text="{Binding SelectedPlan.MemberName}" 
                    FontSize="16" 
                    FontWeight="SemiBold"
                    Foreground="#1E293B"
                  />
                </StackPanel>
              </Border>
              
              <TextBlock Text="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ø±ÙŠØ§Ù„) *" Style="{StaticResource FieldLabel}" />
              <TextBox
                Text="{Binding DailyAmount}"
                Style="{StaticResource ModernTextBox}"
                Margin="0,0,0,20"
              />
              
              <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ù‡Ù… -->
              <Border
                Background="{StaticResource Card2Color}"
                CornerRadius="10"
                Padding="15"
                Margin="0,0,0,20"
              >
                <StackPanel>
                  <TextBlock
                    Text="ðŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ù‡Ù…"
                    FontWeight="SemiBold"
                    FontSize="14"
                    Margin="0,0,0,10"
                  />
                  <TextBlock>
                    <Run Text="â€¢ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø­Ø§Ù„ÙŠ: " />
                    <Run Text="{Binding SelectedPlan.DailyAmount, StringFormat=N2}" FontWeight="SemiBold" />
                    <Run Text=" Ø±ÙŠØ§Ù„" />
                  </TextBlock>
                  <TextBlock Margin="0,5,0,0">
                    <Run Text="â€¢ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ: " />
                    <Run Text="{Binding SelectedPlan.TotalAmount, StringFormat=N2}" FontWeight="SemiBold" />
                    <Run Text=" Ø±ÙŠØ§Ù„" />
                  </TextBlock>
                  <TextBlock Text="â€¢ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" FontSize="12" Margin="0,5,0,0" Foreground="#64748B" />
                </StackPanel>
              </Border>
              
              <Button
                Command="{Binding UpdatePlanCommand}"
                Style="{StaticResource SuccessButton}"
                Height="50"
              >
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="âœ…" FontSize="20" Margin="0,0,10,0" />
                  <TextBlock Text="Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª" FontSize="16" />
                </StackPanel>
              </Button>
            </StackPanel>
          </Border>
        </Grid>
      </StackPanel>
    </ScrollViewer>
  </Grid>
</UserControl>
