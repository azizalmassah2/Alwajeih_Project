<UserControl
  x:Class="Alwajeih.Views.Collections.ArrearsManagementView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:vm="clr-namespace:Alwajeih.ViewModels.Collections"
  FlowDirection="RightToLeft"
  FontFamily="{StaticResource Tajawal}"
  FontSize="14"
>
  <UserControl.DataContext>
    <vm:ArrearsManagementViewModel />
  </UserControl.DataContext>
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Styles/ScrollBarStyles.xaml" />
                <ResourceDictionary Source="/Resources/Styles/Colors.xaml"/>
                <ResourceDictionary Source="/Resources/Styles/Buttons.xaml"/>
                <ResourceDictionary Source="/Resources/Styles/MainStyles.xaml"/>
                <ResourceDictionary Source="/Resources/Styles/DataGrids.xaml"/>
            </ResourceDictionary.MergedDictionaries>

        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Background="#F8FAFC">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
    <StackPanel Grid.Row="0" Margin="30,25,30,20">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        
        <StackPanel Grid.Column="0">
          <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
            <TextBlock Text="âš ï¸" FontSize="24" Margin="0,0,10,0" VerticalAlignment="Center" />
            <TextBlock
              Text="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª ÙˆØ§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª"
              FontSize="22"
              FontWeight="Bold"
              Foreground="#1E293B"
              VerticalAlignment="Center"
            />
          </StackPanel>
          <TextBlock
            Text="Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©"
            FontSize="13" Foreground="#64748B" Margin="34,0,0,0"
          />
        </StackPanel>
        
        <!-- Ø²Ø± Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© -->
        <Button Grid.Column="1"
                Command="{Binding ProcessHistoricalDataCommand}"
                Height="45"
                Padding="20,0"
                Background="#8B5CF6"
                BorderBrush="#7C3AED"
                BorderThickness="1"
                Cursor="Hand" Margin="23,6,0,6">
          <Button.Style>
            <Style TargetType="Button">
              <Setter Property="Template">
                <Setter.Value>
                  <ControlTemplate TargetType="Button">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="8"
                            Padding="{TemplateBinding Padding}">
                      <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                      <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#7C3AED"/>
                      </Trigger>
                    </ControlTemplate.Triggers>
                  </ControlTemplate>
                </Setter.Value>
              </Setter>
            </Style>
          </Button.Style>
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="ðŸ”„" FontSize="18" Margin="0,0,8,0" VerticalAlignment="Center"/>
            <TextBlock Text="Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©" FontSize="14" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
          </StackPanel>
        </Button>
      </Grid>
    </StackPanel>

    <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
    <TabControl Grid.Row="1" Margin="30,0,30,25" Background="Transparent" BorderThickness="0"
                SelectedIndex="{Binding SelectedTabIndex}">
      <TabControl.Resources>
        <Style TargetType="TabItem">
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="TabItem">
                <Border x:Name="Border" Background="White" BorderBrush="#E2E8F0" BorderThickness="1,1,1,0" 
                        CornerRadius="12,12,0,0" Padding="24,12" Margin="0,0,8,0">
                  <ContentPresenter ContentSource="Header" />
                </Border>
                <ControlTemplate.Triggers>
                  <Trigger Property="IsSelected" Value="True">
                    <Setter TargetName="Border" Property="Background" Value="White" />
                    <Setter TargetName="Border" Property="BorderBrush" Value="#2563EB" />
                    <Setter TargetName="Border" Property="BorderThickness" Value="2,2,2,0" />
                  </Trigger>
                  <Trigger Property="IsSelected" Value="False">
                    <Setter TargetName="Border" Property="Background" Value="#F8FAFC" />
                  </Trigger>
                </ControlTemplate.Triggers>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </TabControl.Resources>
      
      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª -->
      <TabItem>
        <TabItem.Header>
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="âš ï¸" FontSize="16" Margin="0,0,8,0" />
            <TextBlock Text="Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª" FontSize="15" FontWeight="SemiBold" />
          </StackPanel>
        </TabItem.Header>
            <ScrollViewer VerticalScrollBarVisibility="Auto">
              <StackPanel Margin="20">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ -->
                <Border
                  Background="#EFF6FF"
                  CornerRadius="8"
                  Padding="15"
                  Margin="0,0,0,20"
                >
                  <StackPanel Orientation="Horizontal" FlowDirection="RightToLeft">
                    <TextBlock
                      Text="ðŸ“…"
                      FontSize="20"
                      Margin="0,0,10,0"
                      VerticalAlignment="Center"
                    />
                    <TextBlock
                      FontSize="14"
                      Foreground="#1E40AF"
                      FontFamily="{StaticResource Tajawal}"
                    >
                      <Run Text="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: " FontWeight="Medium" />
                      <Run Text="{Binding CurrentWeekNumber}" FontWeight="Bold" FontSize="16" />
                      <Run Text=" â€¢ " />
                      <Run Text="Ù…ØªØ£Ø®Ø±Ø§Øª Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·" />
                    </TextBlock>
                  </StackPanel>
                </Border>

                <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
                <Border
                  Background="White"
                  CornerRadius="12"
                  Padding="20"
                  Margin="0,0,0,20"
                >
                  <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="0" Opacity="0.05" />
                  </Border.Effect>
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª -->
                    <Border Grid.Column="0" Background="#FEF3C7" CornerRadius="10" Padding="20" Margin="0,0,10,0" BorderBrush="#FDE68A" BorderThickness="1">
                      <StackPanel>
                        <TextBlock Text="âš ï¸" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <TextBlock Text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª" FontSize="13" Foreground="#92400E" HorizontalAlignment="Center" Margin="0,0,0,5" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock Text="(Ù…Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ)" FontSize="10" Foreground="#A16207" HorizontalAlignment="Center" Margin="0,0,0,8" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock FontSize="24" FontWeight="Bold" Foreground="#F59E0B" HorizontalAlignment="Center">
                          <Run Text="{Binding TotalCurrentWeekArrears, StringFormat=N2, Mode=OneWay}"/>
                          <Run Text=" Ø±ÙŠØ§Ù„" FontSize="13" Foreground="#64748B"/>
                        </TextBlock>
                      </StackPanel>
                    </Border>
                    
                    <!-- Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯ -->
                    <Border Grid.Column="1" Background="#FEF2F2" CornerRadius="10" Padding="20" Margin="0,0,10,0" BorderBrush="#FCA5A5" BorderThickness="1">
                      <StackPanel>
                        <TextBlock Text="âŒ" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <TextBlock Text="Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯" FontSize="13" Foreground="#7F1D1D" HorizontalAlignment="Center" Margin="0,0,0,5" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock Text="(ÙŠØ¬Ø¨ ØªØ­ØµÙŠÙ„Ù‡)" FontSize="10" Foreground="#991B1B" HorizontalAlignment="Center" Margin="0,0,0,8" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock FontSize="24" FontWeight="Bold" Foreground="#EF4444" HorizontalAlignment="Center">
                          <Run Text="{Binding UnpaidCurrentArrears, StringFormat=N2, Mode=OneWay}"/>
                          <Run Text=" Ø±ÙŠØ§Ù„" FontSize="13" Foreground="#64748B"/>
                        </TextBlock>
                      </StackPanel>
                    </Border>
                    
                    <!-- Ø§Ù„Ù…Ø³Ø¯Ø¯ -->
                    <Border Grid.Column="2" Background="#DCFCE7" CornerRadius="10" Padding="20" BorderBrush="#86EFAC" BorderThickness="1">
                      <StackPanel>
                        <TextBlock Text="âœ…" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <TextBlock Text="Ø§Ù„Ù…Ø³Ø¯Ø¯" FontSize="13" Foreground="#15803D" HorizontalAlignment="Center" Margin="0,0,0,5" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock Text="(ØªÙ… ØªØ­ØµÙŠÙ„Ù‡)" FontSize="10" Foreground="#16A34A" HorizontalAlignment="Center" Margin="0,0,0,8" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock FontSize="24" FontWeight="Bold" Foreground="#10B981" HorizontalAlignment="Center">
                          <Run Text="{Binding PaidCurrentArrears, StringFormat=N2, Mode=OneWay}"/>
                          <Run Text=" Ø±ÙŠØ§Ù„" FontSize="13" Foreground="#64748B"/>
                        </TextBlock>
                      </StackPanel>
                    </Border>
                  </Grid>
                </Border>
                
                <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ« -->
                <Border
                  Background="White"
                  CornerRadius="12"
                  Padding="20"
                  Margin="0,0,0,20"
                >
                  <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="0" Opacity="0.05" />
                  </Border.Effect>
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="200" />
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ -->
                    <TextBlock
                      Grid.Column="0"
                      Text="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:"
                      VerticalAlignment="Center"
                      FontSize="14"
                      FontWeight="Medium"
                      Margin="0,0,15,0"
                      FontFamily="{StaticResource Tajawal}"
                    />
                    <ComboBox
                      Grid.Column="1"
                      ItemsSource="{Binding AvailableWeeksForCurrent}"
                      SelectedItem="{Binding SelectedCurrentWeekNumber}"
                      Style="{StaticResource ModernComboBox}"
                      Height="45"
                      FontSize="14"
                      FontFamily="{StaticResource Tajawal}"
                    />

                    <!-- Ø¨Ø­Ø« -->
                    <TextBox
                      Grid.Column="2"
                      Text="{Binding CurrentWeekSearchText, UpdateSourceTrigger=PropertyChanged}"
                      Style="{StaticResource ModernTextBox}"
                      Height="45"
                      FontSize="14"
                      Margin="15,0"
                      FontFamily="{StaticResource Tajawal}"
                    >
                      <TextBox.Resources>
                        <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                          <Style.Triggers>
                            <Trigger Property="Text" Value="">
                              <Setter Property="Background">
                                <Setter.Value>
                                  <VisualBrush Stretch="None" AlignmentX="Right">
                                    <VisualBrush.Visual>
                                      <TextBlock
                                        Text="ðŸ” Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø¶Ùˆ..."
                                        Foreground="#94A3B8"
                                        FontSize="14"
                                        Margin="10,0"
                                        FontFamily="{StaticResource Tajawal}"
                                      />
                                    </VisualBrush.Visual>
                                  </VisualBrush>
                                </Setter.Value>
                              </Setter>
                            </Trigger>
                          </Style.Triggers>
                        </Style>
                      </TextBox.Resources>
                    </TextBox>

                    <!-- Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
                    <Button
                      Grid.Column="3"
                      Command="{Binding RefreshCurrentWeekCommand}"
                      Style="{StaticResource PrimaryButton}"
                      Width="120"
                      Height="45"
                    >
                      <StackPanel Orientation="Horizontal" FlowDirection="RightToLeft">
                        <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,8,0" />
                        <TextBlock Text="ØªØ­Ø¯ÙŠØ«" FontSize="14" FontFamily="{StaticResource Tajawal}" />
                      </StackPanel>
                    </Button>
                  </Grid>
                </Border>

                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª -->
                <Border
                  Background="White"
                  CornerRadius="12"
                  Padding="25"
                  BorderBrush="#E2E8F0"
                  BorderThickness="1"
                >
                  <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="0" Opacity="0.08" />
                  </Border.Effect>
                  <StackPanel>
                    <TextBlock
                      Text="ðŸ“‹ Ù…ØªØ£Ø®Ø±Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡"
                      FontSize="18"
                      FontWeight="SemiBold"
                      Foreground="#1E293B"
                      Margin="0,0,0,20"
                      FontFamily="{StaticResource Tajawal}"
                    />

                    <DataGrid
                      ItemsSource="{Binding CurrentWeekArrears}"
                      SelectedItem="{Binding SelectedCurrentWeekArrear}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      Style="{StaticResource ModernDataGrid}"
                      MaxHeight="500"
                      LoadingRow="DataGrid_LoadingRow"
                      FontFamily="{StaticResource Tajawal}"
                      FontSize="14"
                      FontWeight="Medium"
                    >
                      <DataGrid.Columns>
                        <DataGridTemplateColumn Header="#" Width="50">
                          <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                              <TextBlock
                                Text="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Header}"
                                HorizontalAlignment="Center"
                                FontWeight="SemiBold"
                              />
                            </DataTemplate>
                          </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn
                          Header="Ø§Ù„Ø¹Ø¶Ùˆ"
                          Binding="{Binding MemberName}"
                          Width="2*"
                        />
                        <DataGridTextColumn
                          Header="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…"
                          Binding="{Binding DaysCount}"
                          Width="*"
                        />
                        <DataGridTextColumn
                          Header="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø§Øª"
                          Binding="{Binding TotalArrears, StringFormat=N2}"
                          Width="1.3*"
                        >
                          <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                              <Setter Property="Foreground" Value="#F59E0B"/>
                              <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                          </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                          Header="Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ"
                          Binding="{Binding RemainingAmount, StringFormat=N2}"
                          Width="1.2*"
                        >
                          <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                              <Setter Property="Foreground" Value="#EF4444"/>
                              <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                          </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                          Header="Ø§Ù„Ù…Ø³Ø¯Ø¯"
                          Binding="{Binding PaidAmount, StringFormat=N2}"
                          Width="1.2*"
                        >
                          <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                              <Setter Property="Foreground" Value="#10B981"/>
                              <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                          </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                          Header="Ø§Ù„Ø­Ø§Ù„Ø©"
                          Binding="{Binding Status}"
                          Width="1.2*"
                        >
                          <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                              <Setter Property="HorizontalAlignment" Value="Center"/>
                              <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                          </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                      </DataGrid.Columns>
                    </DataGrid>
                  </StackPanel>
                </Border>
              </StackPanel>
            </ScrollViewer>
          </TabItem>

      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª -->
      <TabItem>
        <TabItem.Header>
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="ðŸ“…" FontSize="16" Margin="0,0,8,0" />
            <TextBlock Text="Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª" FontSize="15" FontWeight="SemiBold" />
          </StackPanel>
        </TabItem.Header>
            <ScrollViewer VerticalScrollBarVisibility="Auto">
              <StackPanel Margin="20">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª -->
                <Border
                  Background="#FEF2F2"
                  CornerRadius="8"
                  Padding="15"
                  Margin="0,0,0,20"
                >
                  <StackPanel Orientation="Horizontal" FlowDirection="RightToLeft">
                    <TextBlock
                      Text="ðŸ“‹"
                      FontSize="20"
                      Margin="0,0,10,0"
                      VerticalAlignment="Center"
                    />
                    <TextBlock
                      FontSize="14"
                      Foreground="#7F1D1D"
                      FontFamily="{StaticResource Tajawal}"
                    >
                      <Run Text="Ù…ØªØ£Ø®Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…Ø­ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ" FontWeight="Medium"/>
                      <Run Text=" â€¢ " FontWeight="Bold"/>
                      <Run Text="Ù…ÙØ±Ø§ÙƒÙ…Ø© Ù„ÙƒÙ„ Ø¹Ø¶Ùˆ" FontWeight="Bold"/>
                    </TextBlock>
                  </StackPanel>
                </Border>

                <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
                <Border
                  Background="White"
                  CornerRadius="12"
                  Padding="20"
                  Margin="0,0,0,20"
                >
                  <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="0" Opacity="0.05" />
                  </Border.Effect>
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª -->
                    <Border Grid.Column="0" Background="#FEF2F2" CornerRadius="10" Padding="20" Margin="0,0,10,0" BorderBrush="#FCA5A5" BorderThickness="1">
                      <StackPanel>
                        <TextBlock Text="ðŸ“‹" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <TextBlock Text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª" FontSize="13" Foreground="#7F1D1D" HorizontalAlignment="Center" Margin="0,0,0,5" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock Text="(Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹)" FontSize="10" Foreground="#991B1B" HorizontalAlignment="Center" Margin="0,0,0,8" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock FontSize="24" FontWeight="Bold" Foreground="#DC2626" HorizontalAlignment="Center">
                          <Run Text="{Binding TotalPreviousArrears, StringFormat=N2, Mode=OneWay}"/>
                          <Run Text=" Ø±ÙŠØ§Ù„" FontSize="13" Foreground="#64748B"/>
                        </TextBlock>
                      </StackPanel>
                    </Border>
                    
                    <!-- Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯ -->
                    <Border Grid.Column="1" Background="#FEF3C7" CornerRadius="10" Padding="20" Margin="0,0,10,0" BorderBrush="#FDE68A" BorderThickness="1">
                      <StackPanel>
                        <TextBlock Text="âš ï¸" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <TextBlock Text="Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯" FontSize="13" Foreground="#92400E" HorizontalAlignment="Center" Margin="0,0,0,5" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock Text="(Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹)" FontSize="10" Foreground="#A16207" HorizontalAlignment="Center" Margin="0,0,0,8" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock FontSize="24" FontWeight="Bold" Foreground="#F59E0B" HorizontalAlignment="Center">
                          <Run Text="{Binding RemainingPreviousArrears, StringFormat=N2, Mode=OneWay}"/>
                          <Run Text=" Ø±ÙŠØ§Ù„" FontSize="13" Foreground="#64748B"/>
                        </TextBlock>
                      </StackPanel>
                    </Border>
                    
                    <!-- Ø§Ù„Ù…Ø³Ø¯Ø¯ -->
                    <Border Grid.Column="2" Background="#DCFCE7" CornerRadius="10" Padding="20" BorderBrush="#86EFAC" BorderThickness="1">
                      <StackPanel>
                        <TextBlock Text="âœ…" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <TextBlock Text="Ø§Ù„Ù…Ø³Ø¯Ø¯" FontSize="13" Foreground="#15803D" HorizontalAlignment="Center" Margin="0,0,0,5" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock Text="(Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹)" FontSize="10" Foreground="#16A34A" HorizontalAlignment="Center" Margin="0,0,0,8" FontFamily="{StaticResource Tajawal}"/>
                        <TextBlock FontSize="24" FontWeight="Bold" Foreground="#10B981" HorizontalAlignment="Center">
                          <Run Text="{Binding PaidPreviousArrears, StringFormat=N2, Mode=OneWay}"/>
                          <Run Text=" Ø±ÙŠØ§Ù„" FontSize="13" Foreground="#64748B"/>
                        </TextBlock>
                      </StackPanel>
                    </Border>
                  </Grid>
                </Border>

                <!-- Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„ØªØ±Ø© -->
                <Border
                  Background="White"
                  CornerRadius="12"
                  Padding="20"
                  Margin="0,0,0,20"
                >
                  <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="0" Opacity="0.05" />
                  </Border.Effect>
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="200" />
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Ù…Ø¹Ø·Ù‘Ù„ - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹) -->
                    <TextBlock
                      Grid.Column="0"
                      Text="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:"
                      VerticalAlignment="Center"
                      FontSize="14"
                      FontWeight="Medium"
                      Margin="0,0,15,0"
                      FontFamily="{StaticResource Tajawal}"
                      Visibility="Collapsed"
                    />
                    <ComboBox
                      Grid.Column="1"
                      ItemsSource="{Binding AvailableWeeks}"
                      SelectedItem="{Binding SelectedWeekNumber}"
                      Style="{StaticResource ModernComboBox}"
                      Height="45"
                      FontSize="14"
                      FontFamily="{StaticResource Tajawal}" IsEnabled="False"
                    />

                    <!-- Ø¨Ø­Ø« -->
                    <TextBox
                      Grid.Column="2"
                      Text="{Binding PreviousArrearsSearchText, UpdateSourceTrigger=PropertyChanged}"
                      Style="{StaticResource ModernTextBox}"
                      Height="45"
                      FontSize="14"
                      Margin="15,0"
                      FontFamily="{StaticResource Tajawal}"
                    >
                      <TextBox.Resources>
                        <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBox}">
                          <Style.Triggers>
                            <Trigger Property="Text" Value="">
                              <Setter Property="Background">
                                <Setter.Value>
                                  <VisualBrush Stretch="None" AlignmentX="Right">
                                    <VisualBrush.Visual>
                                      <TextBlock
                                        Text="ðŸ” Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø¶Ùˆ..."
                                        Foreground="#94A3B8"
                                        FontSize="14"
                                        Margin="10,0"
                                        FontFamily="{StaticResource Tajawal}"
                                      />
                                    </VisualBrush.Visual>
                                  </VisualBrush>
                                </Setter.Value>
                              </Setter>
                            </Trigger>
                          </Style.Triggers>
                        </Style>
                      </TextBox.Resources>
                    </TextBox>

                    <!-- Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
                    <Button
                      Grid.Column="3"
                      Command="{Binding RefreshPreviousArrearsCommand}"
                      Style="{StaticResource PrimaryButton}"
                      Width="120"
                      Height="45"
                    >
                      <StackPanel Orientation="Horizontal" FlowDirection="RightToLeft">
                        <TextBlock Text="ðŸ”„" FontSize="16" Margin="0,0,8,0" />
                        <TextBlock Text="ØªØ­Ø¯ÙŠØ«" FontSize="14" FontFamily="{StaticResource Tajawal}" />
                      </StackPanel>
                    </Button>
                  </Grid>
                </Border>

                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª -->
                <Border
                  Background="White"
                  CornerRadius="12"
                  Padding="25"
                  BorderBrush="#E2E8F0"
                  BorderThickness="1"
                >
                  <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="15" ShadowDepth="0" Opacity="0.08" />
                  </Border.Effect>
                  <StackPanel>
                    <TextBlock
                      FontSize="18"
                      FontWeight="SemiBold"
                      Foreground="#1E293B"
                      Margin="0,0,0,20"
                      FontFamily="{StaticResource Tajawal}"
                    >
                      <Run Text="ðŸ“‹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø© (Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹)" />
                    </TextBlock>

                    <DataGrid
                      ItemsSource="{Binding PreviousArrears}"
                      SelectedItem="{Binding SelectedPreviousArrear}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      Style="{StaticResource ModernDataGrid}"
                      MaxHeight="500"
                      LoadingRow="DataGrid_LoadingRow"
                      FontFamily="{StaticResource Tajawal}"
                      FontSize="14"
                      FontWeight="Medium"
                    >
                      <DataGrid.Columns>
                        <DataGridTemplateColumn Header="#" Width="50">
                          <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                              <TextBlock
                                Text="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=Header}"
                                HorizontalAlignment="Center"
                                FontWeight="SemiBold"
                              />
                            </DataTemplate>
                          </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn
                          Header="Ø§Ù„Ø¹Ø¶Ùˆ"
                          Binding="{Binding MemberName}"
                          Width="2*"
                        />
                        <DataGridTextColumn
                          Header="Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹"
                          Binding="{Binding WeeksRange}"
                          Width="*"
                        />
                        <DataGridTextColumn
                          Header="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"
                          Binding="{Binding TotalArrears, StringFormat=N2}"
                          Width="1.3*"
                        >
                          <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                              <Setter Property="Foreground" Value="#1E293B"/>
                              <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                          </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                          Header="Ø§Ù„Ù…Ø³Ø¯Ø¯"
                          Binding="{Binding PaidAmount, StringFormat=N2}"
                          Width="1.2*"
                        >
                          <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                              <Setter Property="Foreground" Value="#10B981"/>
                              <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                          </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                          Header="Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ"
                          Binding="{Binding RemainingAmount, StringFormat=N2}"
                          Width="1.2*"
                        >
                          <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                              <Setter Property="Foreground" Value="#DC2626"/>
                              <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                          </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                          Header="Ø§Ù„Ø­Ø§Ù„Ø©"
                          Binding="{Binding Status}"
                          Width="*"
                        >
                          <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                              <Setter Property="FontWeight" Value="Bold"/>
                              <Setter Property="HorizontalAlignment" Value="Center"/>
                            </Style>
                          </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                      </DataGrid.Columns>
                    </DataGrid>
                    
                    <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª -->
                    <Border
                      Background="#FEF2F2"
                      CornerRadius="8"
                      Padding="15"
                      Margin="0,15,0,0"
                    >
                      <Grid>
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*"/>
                          <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock
                          Text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù…ÙØ±Ø§ÙƒÙ…Ø©"
                          FontSize="15"
                          FontWeight="SemiBold"
                          Foreground="#7F1D1D"
                          VerticalAlignment="Center"
                          FontFamily="{StaticResource Tajawal}"
                        />
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                          <TextBlock
                            Text="{Binding TotalPreviousArrears, StringFormat=N2, Mode=OneWay}"
                            FontSize="18"
                            FontWeight="Bold"
                            Foreground="#DC2626"
                            VerticalAlignment="Center"
                            Margin="0,0,5,0"
                          />
                          <TextBlock
                            Text="Ø±ÙŠØ§Ù„"
                            FontSize="13"
                            Foreground="#64748B"
                            VerticalAlignment="Center"
                          />
                        </StackPanel>
                      </Grid>
                    </Border>
                  </StackPanel>
                </Border>
              </StackPanel>
            </ScrollViewer>
          </TabItem>
        </TabControl>
  </Grid>
</UserControl>
